<!DOCTYPE html>
<html>
  <head>
    <title>车辆管理</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="css/jBootsrapPage.css" rel="stylesheet"/>
    <link href="css/fineuploader.css" rel="stylesheet">
    
    <link href="css/base.css" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
  </head>
  <body>
<!-- <div class="container">
     <div class="row top">
    	<div class="span1"></div>
    	<div class="span10">
        <div class="row headimg">
        <div class="span6 top30"><a href="" id="logo"><img src="images/logo.png" class="logoimg"/></a></div>
        <div class="span4 topb">
           <div class="navbar">
           	    <div class="">
		           	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				      </a>
				      <div class="nav-collapse collapse">
					    <ul class="nav pull-right">
					      <li><a><img src="" id="userimg"/></a></li>
					      <li><a id="username"></a></li>
					    </ul>
				      </div>
			  </div>
			</div>
        </div>
   		</div>
   		</div>
   		<div class="span1"></div>
    </div>

   <div class="row">
		 <div class="span12 thumbnail noborder">
				<div class="flash">
					<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0"  width="1050" height="405" align="center">
						<param name="movie" value="flash/index.swf">
						<param name="quality" value="high">
						<param name="wmode" value="transparent">
						<embed src="flash/index.swf"  wmode="transparent"  width="1050" height="405" align="center" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>
					</object>
				</div>
		 </div>
    </div>
        <div class="row">
    		<div class="span1"></div>
		    <div class="span10">
		    <div class="navbar">
			    <div class="navbar-inner">
			        <ul class="nav">			            
			            <li class="active" id="clgl"><a href="" id="clli">车辆管理</a></li>
			            <li id="crgl"><a  href="" id="crli">出入管理</a></li>
			            <li id="dcgl"><a  href="parking.html" id="dcli">停车场管理</a></li>
			        </ul>
			     </div>   
			</div>
		    </div>
		    <div class="span1"></div>
    </div>
    <div class="row">
    	<div class="span1"></div>
		 <div class="span10">
	 	    <div class="row">
	 	    	<div class="span10 h40"></div>
				 <div class="span10">
				 	<div class="row">
				 		<div class="span10">
					 		<div class="left"><h4>车辆管理</h4></div>
							<div class="right">
							<table><tr><td><div class="upload-button" id="bootstrapped-fine-uploader"></div></td><td><button id="addbutton" class="btn btn-warning"><i class="icon-plus"></i>增加</button>	</td></tr></table>
							</div>
				 		</div>
				 		<div class="span10 h5"></div>
				 		<div class="span10">
				 			<div class="right">车辆总数：<a id="total"></a>&nbsp;&nbsp;辆</div>
							<ul class="nav nav-tabs">
						        <li class="active"><a href="" id="cya">常用车辆</a></li>
						        <li class="dhlhide" id="fkli"><a href="" id="fka">访客车辆</a></li>
						    </ul>
					 		
				 			<table class="table table-striped table-bordered table-hover" id="cartable"></table>
				 			<ul class="pagination"></ul>
				 		</div>
				 	</div>
				 </div>
		    </div>
		 </div>
    	<div class="span1"></div>
    </div>
</div> -->
<!-- 
                  	<div class="footer">
		<div class="footerCon">
			<div class="copyright">
				<p>版权所有：无锡旅游商贸高等职业技术学校   COPYRIGHT © 2010 ALL RIGHTS RESERVED </p>
				<p>地址：无锡市广石路999号 <span>电话：0510-83116678</span>    <span> 苏ICP备:09007163</span>技术支持：南京第五十五所技术开发有限公司</p>
			</div>
			<div class="logobottom">
				<img src="images/logobottom.gif"/>
			</div>
			<div class="clear"></div>
		</div>
	</div> -->

<!-- <div class="content"> -->
		<div class="contentwrap">
			<div class="top" style="height:30px;>
				<div class="header png_bg">
					<!-- <div class="logo"><a href="" id="logo"><img src="images/logo.png"/></a></div> -->
					<!-- <div class="login"> 						
					   <div class="loginwrap">
							<div class="inputwrap">
								<a><img src="" id="userimg"  width="50px"/></a>
								<a id="username"></a>
							</div>
						</div>
					</div> -->
					<!-- <div class="clear"></div> -->
					<div class="dhlnav menu" id="nav">
						<ul class="dhlnav">			            
				            <li class="dhlactive" id="clgl"><a href="" id="clli">车辆管理</a></li>
				            <li id="crgl"><a  href="" id="crli">出入管理</a></li>
				            <li id="dcgl"><a id="dcli">停车场管理</a></li>
				            <li id="ledgl"><a id="ledli">显示屏管理</a></li>
			        	</ul>
						<div class="clear"></div>
					</div>
				</div>
			<div class="conmain png_bg">
				<div class="contentTop">
					<!-- <div class="contentTopLeft">
						<div id="scrollWrap"> 
							<ul id="scrollMsg"> 
								<li><a class="msgtip" href="#">车辆管理</a></li>
							</ul>
						</div>
					</div> -->
					<div class="clear"></div>
				</div>
				<div class="copyright"><h1>常用车辆管理</h1></div>
				<div class="logobottom">
				<table><tr>
				<td><div class="upload-button" id="bootstrapped-fine-uploader"></div></td>
				<td>&nbsp;&nbsp;</td>
				<td><a href="importcar.action"><button class="btn btn-warning"><i class="icon-download"></i>导出</button>	</a></td>
				<td>&nbsp;&nbsp;</td>
				<td><button id="addbutton" class="btn btn-warning"><i class="icon-plus"></i>增加</button>	</td>
				</tr>
				</table>
				</div>
				<div class="clear"></div>
							
				<div class="logobottom">车辆总数：<a id="total"></a>&nbsp;&nbsp;辆</div>
				<ul class="nav nav-tabs">
			         <li class="active"><a href="" id="cya">常用车辆</a></li>
			        <li id="fkli"><a href="" id="fka">访客车辆</a></li>
			    </ul>
		 		
	 			<table class="table table-striped table-bordered table-hover" id="cartable"></table>
	 			<ul class="pagination"></ul>
			</div>
		</div>
	<!-- </div> -->

	<div class="footer">
		<!-- <div class="footerCon">
			<div class="copyright">
				<p>版权所有：无锡旅游商贸高等职业技术学校   COPYRIGHT © 2010 ALL RIGHTS RESERVED </p>
				<p>地址：无锡市广石路999号 <span>电话：0510-83116678</span>    <span> 苏ICP备:09007163</span>技术支持：南京第五十五所技术开发有限公司</p>
			</div>
			<div class="logobottom">
				<img src="images/logobottom.gif"/>
			</div>
			<div class="clear"></div>
		</div> -->
	</div>
		
<div id="myModal" class="modal hide fade">
    <div class="modal-header">
        <button class="close" data-dismiss="modal">×</button>
        <h3>车辆管理</h3>
    </div>
    <div class="modal-body">
        <form method="post" action="" class=" form-horizontal">
        	<input type="hidden" id="id">
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="card"><a class="rcol">*</a>车牌：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="card" />
		        </div>
		    </div>
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="caruser"><a class="rcol">*</a>车主：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="caruser"/>
		        </div>
		    </div>
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="tel"><a class="rcol"></a>联系方式：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="tel"/>
		        </div>
		    </div>		    
		</form>
    </div>
    <div class="modal-footer">
    	<button class="btn btn-info" id="add">增加</button>
    	<button class="btn btn-info hide" id="update">修改</button>
        <button class="btn btn-info" data-dismiss="modal">关闭</button>
    </div>
</div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="bootstrap/js/jquery-1.9.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/jBootstrapPage.js"></script>
    <script src="js/fineuploader.js"></script>
    <script src="js/common.js"></script>
    <script>
	    $(document).ready(function(){
	    	
	    	var array = parseUrl();	    	
	    	var b = array[0];
	    	
	    	if ("admin" == b)
	    	{	    		    	
	    		$("#logo").attr("href","/carplat/");
	    		$("#crli").attr("href","/carplat/inout.html");
	    		$("#clli").attr("href","/carplat/");
	    		$("#dcli").attr("href","/carplat/parking.html");
	    		$("#ledli").attr("href","/carplat/led.html");
	    		$("#cya").attr("href","/carplat/");
	    		$("#fka").attr("href","/carplat/tmpcar.html");
		    	//管理员
		    	$("#fkli").removeClass("dhlhide");		    	    	
		    	
		    	$("#username").html("管理员");	    	
		    	$("#userimg").attr("src","images/user.png");
		    	initCar(1,0,"admin");
	    	}
	    	else
	    	{
		    	var role = array[1];		    	
	    		$("#logo").attr("href","/carplat/index.html?"+b);
	    		$("#crli").attr("href","/carplat/inout.html?"+b);
	    		$("#clli").attr("href","/carplat/index.html?"+b);
	    		$("#dcli").attr("href","/carplat/parking.html?"+b);
	    		$("#ledli").attr("href","/carplat/led.html?"+b);
	    		$("#cya").attr("href","/carplat/index.html?"+b);
	    		$("#fka").attr("href","/carplat/tmpcar.html?"+b);
		    	//管理员
		    	if (role == 0)
		    	{
		    		$("#crgl").show();
		    		/* $(".icon-pencil").show();
		    		$(".icon-trash").show(); */
		    	}
		    	else// if (role == 1)
		    	{		    		
		    		$("#crgl").hide();
		    		/* $(".icon-pencil").hide();
		    		$(".icon-trash").hide(); */
		    	}    	
		    	var username = array[2];
		    	$("#username").html(username);	    	
		    	$("#userimg").attr("src",array[3]);
		    	initCar(1,role,username);
	    	}
	    	$("#addbutton").click(function(){	
	    		
				$("#add").show();
				$("#update").hide();
				/*$("#id").attr("value",'');
	    		$("#code").attr("value",'');
				$("#card").attr("value",'');
				$("#cartype").attr("value",'');
				$("#caruser").attr("value",'');
				$("#tpye").attr("value",'');
				$("#carposition").attr("value",'');
				$("#paytype").attr("value",'');
				$("#tel").attr("value",'');*/
				document.getElementById("id").value='';
				//document.getElementById("code").value='';
				document.getElementById("card").value='';
				//document.getElementById("cartype").value='';
				var array = parseUrl();
				var b = array[0];	    	
	    	   if ("admin" == b)
	    	   {
		    	        document.getElementById("caruser").value='';
						//document.getElementById("caruser").disabled = false;
	    	   }
	    	   else
	    	   {
		    	   var role = array[1];
					if (role == 0)
					{
						document.getElementById("caruser").value='';
						//document.getElementById("caruser").disabled = false;
					}
					else
					{
						var username = array[2];
						document.getElementById("caruser").value=username;
						//document.getElementById("caruser").disabled = true;
					}
	    	   }
				
				//document.getElementById("tpye").value='';
				//document.getElementById("carposition").value='';
				//document.getElementById("paytype").value='';
				document.getElementById("tel").value='';
	    		  		
				$('#myModal').modal('show');
				
			});
			$("#add").click(function(){
				save("saveCar.action");
			});
			$("#update").click(function(){
				save("updateCar.action");
			});
			createUploader();
		});
	    function createUploader() { 
	    	var uploader = new qq.FineUploader({ 
	    	element: document.getElementById('bootstrapped-fine-uploader'), 
	    	request: { 
	    	endpoint: 'upload.action' 
	    	}, 
	    	text: { 
	    	uploadButton: '<button class="btn btn-warning"><i class="icon-upload"></i>导入</button>' 
	    	}, 
	    	validation:{
	    		allowedExtensions: ['csv'],
	    		sizeLimit: 204800
	    	},
	    	template: 
	    	'<div class="qq-uploader">' + 
	    	'<pre class="qq-upload-drop-area"><span>{dragZoneText}</span></pre>' + 
	    	'<div class="qq-upload-button btn" style="width: auto;">{uploadButtonText}</div>' + 
	    	'<span class="qq-drop-processing"><span>{dropProcessingText}</span>'+ 
	    	'<span class="qq-drop-processing-spinner"></span></span>' + 
	    	'<ul class="qq-upload-list" style="margin-top: 10px; text-align: center;display:none"></ul>' + 
	    	'</div>', 
	    	classes: { 
	    	success: 'alert alert-success', 
	    	fail: 'alert alert-error' 
	    	}, 
	    	callbacks:{
	    		onComplete: function(id,  fileName,  responseJSON){		
	    			if (responseJSON.success == "true")
	    			{
	    				alert("导入成功");
	    			}
	    		}
	    	},
	    	debug: true 
	    	}); 
	    	}
	    function save(url)
	    {
	    	var id = $("#id").val();
			//var code = $("#code").val();
			var card = $("#card").val();
			//var cartype = $("#cartype").val();
			var caruser = $("#caruser").val();
			//var tpye = $("#tpye").val();
			//var carposition = $("#carposition").val();
			//var paytype = $("#paytype").val();
			var tel = $("#tel").val();
			if (isNull(card)||isNull(caruser))	
			{					
				alert("全部不能为空");
				return ;
			}	
			var data = {id:id,card:card,caruser:caruser,tel:tel};
			if (url == "saveCar.action")
			{
				data = {card:card,caruser:caruser,tel:tel};
			}
				
	    	$.ajax({
				url:url,
				type:"post",
				data:data,
				success:function(s){
					if ("sucess" == s)
					{
						$('#myModal').modal('hide');
						var array = parseUrl();
						var b = array[0];	    	
	    	   			if ("admin" == b)
	    	   			{
	    	   				initCar(1,0,"管理员");
	    	   			}
	    	   			else
	    	   			{
	    	   				initCar(1,array[1],array[2]);
	    	   			}
						
					}
					else
					{
						alert(s);
					}
				}
				});
	    }
	    function openEditDialog(id)
	    {
	    	$("#id").attr("value",id);
	    	$.ajax({
				url:"getCar.action?id="+id,
				type:"post",
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{
						document.getElementById("card").value=a.card;
						document.getElementById("caruser").value=a.caruser;
						document.getElementById("tel").value=a.tel;
						//$("#card").attr("value",a.card);
						//$("#caruser").attr("value",a.caruser);
						//$("#tel").attr("value",a.tel);
						
						$("#add").hide();
						$("#update").show();
						$('#myModal').modal('show');
					}
				}
				});
	    }
	    function delCar(id)
	    {	    	
	    	$.ajax({
				url:"delCar.action?id="+id,
				type:"post",
				success:function(s){
					if ("sucess" == s)
					{
						var array = parseUrl();
						var b = array[0];	    	
	    	   			if ("admin" == b)
	    	   			{
	    	   				initCar(1,0,"管理员");
	    	   			}
	    	   			else
	    	   			{
	    	   				initCar(1,array[1],array[2]);
	    	   			}
						alert("删除成功");
					}
				}
				});
	    }
	    function createPage(pageSize, buttons, total) {
            $(".pagination").jBootstrapPage({
                pageSize : pageSize,
                total : total,
                maxPageButton:buttons,
                onPageClicked: function(obj, pageIndex) {
                  var pindex = pageIndex+1;
                  initCar(pindex, 0,"管理员");
                }
            });
        }
	    function initCar(pindex,role,username)
	    {
	    	var data = {pindex:pindex,role:role,username:username};
	    	//url:"getAllCar.action?pindex="+pindex+"&role="+role+"&username="+username,
	    	$.ajax({
				url:"getAllCar.action",
				type:"post",
				data:data,
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{
						//alert(a.total+"   ,   "+a.rows.length);
						$("#total").html(a.total);
						var t = '<tr><th>编号</th><th>车牌</th><th>车主</th><th>联系方式</th><th></th></tr>';
						for(var i=0;i<a.rows.length;i++){
								var b = a.rows[i];
			    				t += '<tr><td>'+b.code+'</td><td>'+b.card+'</td><td>'+b.caruser+'</td><td>'+b.tel+'</td><td><a href="javascript:openEditDialog('+b.id+')" class="icon-pencil"></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:delCar('+b.id+')" class="icon-trash"></a></td></tr>';
						}							
						$("#cartable").html(t);
						
						//分页
						if (pindex == 1)
						createPage(10,5,a.total);
					}
				}
				});
	    }
    </script>
  </body>
</html>


