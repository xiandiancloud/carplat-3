<!DOCTYPE html>
<html>
  <head>
    <title>车辆管理</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <link href="css/style.css" rel="stylesheet">
    <link href="css/jBootsrapPage.css" rel="stylesheet"/>
    <link href="css/fineuploader.css" rel="stylesheet">
    <link href="css/datepicker.css" rel="stylesheet"/>
  </head>
  <body>
<div class="container">
 <!-- <div class="row top">
        <div class="span3 top20"><a href="" id="logo"><img src="images/logo.png"/></a></div>
        <div class="span9 topb">
           <div class="navbar">
           	navbar-inner
	           <div class="">
		           	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				      </a>
				      <div class="nav-collapse collapse">
				        <ul class="nav">					   
					      <li id="crgl"><a href="" id="crli">出入管理</a></li>
					      <li class="current"><a href="" id="clli">车辆管理</a></li>
					    </ul>
					    <ul class="nav pull-right">
					      <li><a><img src="" id="userimg"/></a></li>
					      <li><a id="username"></a></li>
					    </ul>
				      </div>
			  </div>
			</div>
        </div>
    </div> -->
    <div class="row top">
    	<div class="span1"></div>
    	<div class="span10">
        <div class="row headimg">
        <div class="span6 top30"><a href="" id="logo"><img src="images/logo.png" class="logoimg"/></a></div>
        <div class="span4 topb">
           <div class="navbar">
           	    <div class="">
		           	  <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				        <span class="icon-bar"></span>
				      </a>
				      <div class="nav-collapse collapse">
				      <!--   <ul class="nav">					   
					      <li class="current" id="crgl"><a href="" id="crli">出入管理</a></li>
					      <li id="clgl"><a href="" id="clli">车辆管理</a></li>
					    </ul> -->
					    <ul class="nav pull-right">
					      <li><a><img src="" id="userimg"/></a></li>
					      <li><a id="username"></a></li>
					    </ul>
				      </div>
			  </div>
			</div>
        </div>
   		</div>
   		</div>
   		<div class="span1"></div>
    </div>
<!--     <div class="row">
    <div class="span12 split"></div>
    </div>
    <div class="row">
    <div class="span12 h100"></div>
    </div> -->
     <div class="row">
		 <div class="span12 thumbnail noborder">
				<div class="flash">
					<!-- <img src="images/flash.png" class="png_bg"/> -->
					
					<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0"  width="1050" height="405" align="center">
						<param name="movie" value="flash/index.swf">
						<param name="quality" value="high">
						<param name="wmode" value="transparent">
						<embed src="flash/index.swf"  wmode="transparent"  width="1050" height="405" align="center" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash"></embed>
					</object>
				</div>
	 	    <!-- <div class="row">
				 <div class="span1"></div>
				 <div class="span3 h280">
				 	<div class="row">
				 		<div class="span3">
					 		<div class="h180 topc">
					 			<div class="row">
					 				<div class="span3 h40"></div>
					 				<div class="span3 textcenter"><h3>剩余车位</h3></div>
					 				
					 				<div class="span3 textcenter"><h3>25</h3></div>
					 			</div>
					 		</div>
					 		<div class="h100 hcol"></div>
				 		</div>
				 	</div>
				 </div>
				 <div class="span8"></div>
		    </div> -->
		 </div>
    </div>
            <div class="row">
    		<div class="span1"></div>
		    <div class="span10">
		    <div class="navbar">
			    <div class="navbar-inner">
			        <ul class="nav">			            
			            <li class="active" id="clgl"><a href="" id="clli">车辆管理</a></li>
			            <li id="crgl"><a  href="" id="crli">出入管理</a></li>
			        </ul>
			     </div>   
			</div>
		    </div>
		    <div class="span1"></div>
    </div>
    <div class="row">
    	<div class="span1"></div>
		 <div class="span10">
	 	    <div class="row">
	 	    	<div class="span10 h40"></div>
				 <div class="span10">
				 	<div class="row">
				 		<div class="span10">
					 		<div class="left"><h4>车辆管理</h4></div>
							<div class="right">
								<button id="addbutton" class="btn btn-warning"><i class="icon-plus"></i>增加</button>
							</div>
				 		</div>
				 		<div class="span10 h5"></div>
				 		<div class="span10">
				 		
				 		<div class="right">车辆总数：<a id="total"></a>&nbsp;&nbsp;辆</div>
							<ul class="nav nav-tabs">
						        <li><a href="" id="cya">常用车辆</a></li>
						        <li class="active" id="fkli"><a href="" id="fka">访客车辆</a></li>
						    </ul>
			 				<table class="table table-striped table-bordered table-hover" id="cartable"></table>
			 				<ul class="pagination"></ul>
				 		</div>
				 	</div>
				 </div>
		    </div>
		 </div>
   		 <div class="span1"></div>
    </div>
    
<!--      <div class="row">
	    <div class="span12 h20"></div>
	    <div class="span12 split"></div>
	    <div class="span12 h5"></div>
        <div class="span12 footer">
          <h4>无锡旅游商贸高等职业技术学校 2014</h4>
        </div>  
      </div> -->

</div>

                  	<div class="footer">
		<div class="footerCon">
			<div class="copyright">
				<p>版权所有：无锡旅游商贸高等职业技术学校   COPYRIGHT © 2010 ALL RIGHTS RESERVED </p>
				<p>地址：无锡市广石路999号 <span>电话：0510-83116678</span>    <span> 苏ICP备:09007163</span>技术支持：南京第五十五所技术开发有限公司</p>
			</div>
			<div class="logobottom">
				<img src="images/logobottom.gif"/>
			</div>
			<div class="clear"></div>
		</div>
	</div>
	
<div id="myModal" class="modal hide fade">
    <div class="modal-header">
        <button class="close" data-dismiss="modal">×</button>
        <h3>车辆管理</h3>
    </div>
    <div class="modal-body">
        <form method="post" action="" class=" form-horizontal">
        	<input type="hidden" id="id">
<!-- 		    <div class="control-group">
		    	<div class="control-label">    
		        	<label for="code"><a class="rcol">*</a>编号：</label>
		        </div>
		        <div class="controls">        
		        	<input type="text" id="code" />
		        </div>        
		    </div> -->
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="card"><a class="rcol">*</a>车牌：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="card" />
		        </div>
		    </div>
		  <!--   <div class="control-group">
		    	<div class="control-label">
		        	<label for="cartype"><a class="rcol">*</a>车型：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="cartype" />
		        </div>
		    </div> -->
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="caruser"><a class="rcol">*</a>车主：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="caruser" />
		        </div>
		    </div>
		 <!--    <div class="control-group dhlhide">
		    	<div class="control-label">
		        	<label for="tpye"><a class="rcol">*</a>类型：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="tpye" />
		        </div>
		    </div> 
		    <div class="control-group dhlhide">
		    	<div class="control-label">
		        	<label for="carposition"><a class="rcol">*</a>车位：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="carposition" />
		        </div>
		    </div>
		    <div class="control-group dhlhide">
		    	<div class="control-label">
		        	<label for="paytype"><a class="rcol">*</a>缴费类型：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="paytype" />
		        </div>
		    </div>-->
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="tel"><a class="rcol"></a>联系方式：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="tel"/>
		        </div>
		    </div>	
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="address"><a class="rcol"></a>接待地址：</label>
		        </div>
		        <div class="controls">
		        	<input type="text" id="address"/>
		        </div>
		    </div>	
		    <div class="control-group">
		    	<div class="control-label">
		        	<label for="indate"><a class="rcol">*</a>是否有效：</label>
		        </div>
		        <div class="controls">
			        <select name="选择" id="indate">
				        <option value="是" selected="selected">是</option>
				        <option value="否">否</option>
					</select>
		        	<!-- <input type="text" id="indate"/> -->
		        	<!-- <div class="input-append date datetop" id="indate" data-date="" data-date-format="yyyy-mm-dd">
									    <input class="span2" size="16" type="text" value="" readonly>
									    <span class="add-on"><i class="icon-calendar"></i></span>
									</div> -->
		        </div>
		    </div>	    
		</form>
    </div>
    <div class="modal-footer">
    	<button class="btn btn-info" id="add">增加</button>
    	<button class="btn btn-info hide" id="update">修改</button>
        <button class="btn btn-info" data-dismiss="modal">关闭</button>
    </div>
</div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="bootstrap/js/jquery-1.9.1.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="js/jBootstrapPage.js"></script>
    <script src="js/fineuploader.js"></script>
    <script src="js/bootstrap-datepicker.js" ></script>
    <script src="js/common.js" ></script>
    <script>
	    $(document).ready(function(){
	    	//$('#indate').datepicker();	
	    	var array = parseUrl();
	    	var b = array[0];
	    	if ("admin" == b)
	    	{	    	
		    	//管理员
	    		$("#logo").attr("href","/carplat/");
	    		$("#crli").attr("href","/carplat/inout.html");
	    		$("#clli").attr("href","/carplat/");
	    		$("#cya").attr("href","/carplat/");
	    		$("#fka").attr("href","/carplat/tmpcar.html"); 	
		    	
		    	$("#username").html("管理员");	    	
		    	$("#userimg").attr("src","images/user.png");
	    	}
	    	else
	    	{

		    	var role = array[1];
	    		$("#logo").attr("href","/carplat/index.html?"+b);
	    		$("#crli").attr("href","/carplat/inout.html?"+b);
	    		$("#clli").attr("href","/carplat/index.html?"+b);
	    		$("#cya").attr("href","/carplat/index.html?"+b);
	    		$("#fka").attr("href","/carplat/tmpcar.html?"+b);		    	
		    	if (role == 0)
		    	{
		    		$("#crgl").removeClass("dhlhide");
		    		$("#fkli").removeClass("dhlhide");	    		
		    	}
		    	else if (role == 1)
		    	{
		    		$("#fkli").removeClass("dhlhide");
		    		$("#crgl").addClass("dhlhide");
		    	}    	
		    	//管理员
		    	/*if (role == 0)
		    	{
		    		$("#logo").attr("href","/carplat/index.html?"+b);
		    		$("#crli").attr("href","/carplat/inout.html?"+b);
		    		$("#clli").attr("href","/carplat/index.html?"+b);
		    		$("#cya").attr("href","/carplat/index.html?"+b);
		    		$("#fka").attr("href","/carplat/tmpcar.html?"+b);
		    	}
		    	else// if (role == 1)//教师
		    	{
					location.href = "/carplat/car.html?"+b;    		
		    	}	 */	    	
		    	var username = array[2];
		    	$("#username").html(username);	    	
		    	$("#userimg").attr("src",array[3]);
	    	}	    		    	
	    	initCar(1);
	    	$("#addbutton").click(function(){	
				$("#add").show();
				$("#update").hide();
				/*$("#id").attr("value",'');
	    		$("#code").attr("value",'');
				$("#card").attr("value",'');
				$("#cartype").attr("value",'');
				$("#caruser").attr("value",'');
				$("#tpye").attr("value",'');
				$("#carposition").attr("value",'');
				$("#paytype").attr("value",'');
				$("#tel").attr("value",'');
				$("#indate").attr("value",'');*/
				document.getElementById("id").value='';
				//document.getElementById("code").value='';
				document.getElementById("card").value='';
				//document.getElementById("cartype").value='';
				document.getElementById("caruser").value='';
				//document.getElementById("tpye").value='';
				//document.getElementById("carposition").value='';
				//document.getElementById("paytype").value='';
				document.getElementById("address").value='';
				document.getElementById("tel").value='';
				document.getElementById("indate").value='';
				$('#myModal').modal('show');
			});
			$("#add").click(function(){
				save("tmpsaveCar.action");
			});
			$("#update").click(function(){
				save("tmpupdateCar.action");
			});			
			//createUploader();			
		});
	    /* function createUploader() { 
	    	var uploader = new qq.FineUploader({ 
	    	element: document.getElementById('bootstrapped-fine-uploader'), 
	    	request: { 
	    	endpoint: 'upload.action' 
	    	}, 
	    	text: { 
	    	uploadButton: '<button class="btn btn-warning"><i class="icon-upload"></i>导入</button>' 
	    	}, 
	    	validation:{
	    		allowedExtensions: ['csv'],
	    		sizeLimit: 204800
	    	},
	    	template: 
	    	'<div class="qq-uploader">' + 
	    	'<pre class="qq-upload-drop-area"><span>{dragZoneText}</span></pre>' + 
	    	'<div class="qq-upload-button btn" style="width: auto;">{uploadButtonText}</div>' + 
	    	'<span class="qq-drop-processing"><span>{dropProcessingText}</span>'+ 
	    	'<span class="qq-drop-processing-spinner"></span></span>' + 
	    	'<ul class="qq-upload-list" style="margin-top: 10px; text-align: center;display:none"></ul>' + 
	    	'</div>', 
	    	classes: { 
	    	success: 'alert alert-success', 
	    	fail: 'alert alert-error' 
	    	}, 
	    	callbacks:{
	    		onComplete: function(id,  fileName,  responseJSON){		
	    			if (responseJSON.success == "true")
	    			{
	    				alert("导入成功");
	    			}
	    		}
	    	},
	    	debug: true 
	    	}); 
	    	} */
	    function save(url)
	    {
	    	var id = $("#id").val();
			//var code = $("#code").val();			
			var card = $("#card").val();
			//var cartype = $("#cartype").val();
			var caruser = $("#caruser").val();
			//var tpye = $("#tpye").val();
			//var carposition = $("#carposition").val();
			//var paytype = $("#paytype").val();
			var address = $("#address").val();
			var tel = $("#tel").val();
			var indate = $("#indate").val();			
			//indate= new Date(Date.parse(indate.replace(/-/g,   "/")));
			if (isNull(card)||isNull(caruser)||isNull(indate))	
			  {					
				alert("全部不能为空");
				return ;
			  }		
			var data = {id:id,card:card,caruser:caruser,tel:tel,indate:indate,address:address};
			if (url == "tmpsaveCar.action")
			{
				data = {card:card,caruser:caruser,tel:tel,indate:indate,address:address};
			}
	    	$.ajax({
				url:url,
				type:"post",
				data:data,
				success:function(s){
					if ("sucess" == s)
					{
						$('#myModal').modal('hide');
						initCar(1);
					}
					else
					{
						alert(s);
					}
				}
				});
	    }
	    function openEditDialog(id)
	    {
	    	$("#id").attr("value",id);
	    	$.ajax({
				url:"tmpgetCar.action?id="+id,
				type:"post",
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{
						//alert(a.total+"   ,   "+a.rows.length);
						//$("#code").attr("value",a.code);
						$("#card").attr("value",a.card);
						//$("#cartype").attr("value",a.cartype);
						$("#caruser").attr("value",a.caruser);
						//$("#tpye").attr("value",a.tpye);
						//$("#carposition").attr("value",a.carposition);
						//$("#paytype").attr("value",a.paytype);
						$("#tel").attr("value",a.tel);
						$("#address").attr("value",a.address);
						$("#indate").attr("value",a.indate);
						$("#add").hide();
						$("#update").show();
						$('#myModal').modal('show')
					}
				}
				});
	    }
	    function delCar(id)
	    {	    	
	    	$.ajax({
				url:"tmpdelCar.action?id="+id,
				type:"post",
				success:function(s){
					if ("sucess" == s)
					{
						initCar(1);
						alert("删除成功");
					}
				}
				});
	    }
	    function createPage(pageSize, buttons, total) {
            $(".pagination").jBootstrapPage({
                pageSize : pageSize,
                total : total,
                maxPageButton:buttons,
                onPageClicked: function(obj, pageIndex) {
                  var pindex = pageIndex+1;
                  initCar(pindex);
                }
            });
        }
	    function initCar(pindex)
	    {
	    	$.ajax({
				url:"tmpgetAllCar.action?pindex="+pindex,
				type:"post",
				success:function(s){
					var a=eval("("+s+")");
					if (a)
					{
						//alert(a.total+"   ,   "+a.rows.length);
						$("#total").html(a.total);
						var t = '<tr><th>编号</th><th>车牌</th><th>车主</th><th>联系方式</th><th>接待地址</th><th>是否有效</th><th></th></tr>';
						for(var i=0;i<a.rows.length;i++){
								var b = a.rows[i];
			    				t += '<tr><td>'+b.code+'</td><td>'+b.card+'</td><td>'+b.caruser+'</td><td>'+b.tel+'</td><td>'+b.address+'</td><td>'+b.indate+'</td><td><a href="javascript:openEditDialog('+b.id+')" class="icon-pencil"></a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:delCar('+b.id+')" class="icon-trash"></a></td></tr>';
							}							
						$("#cartable").html(t);
						
						//分页
						if (pindex == 1)
						createPage(10,5,a.total);
					}
				}
				});
	    }
    </script>
  </body>
</html>


